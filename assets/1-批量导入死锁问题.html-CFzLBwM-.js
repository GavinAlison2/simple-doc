import{_ as s,c as n,e,o as t}from"./app-DzmgiGLk.js";const p={};function l(c,a){return t(),n("div",null,a[0]||(a[0]=[e(`<h1 id="批量导入死锁问题" tabindex="-1"><a class="header-anchor" href="#批量导入死锁问题"><span>批量导入死锁问题</span></a></h1><h2 id="问题描述" tabindex="-1"><a class="header-anchor" href="#问题描述"><span>问题描述</span></a></h2><p>批量导入100w数据到数据库，实现并发批量3000条数据导入数据库中</p><p>insert 操作时数据违反唯一性约束</p><p>查看死锁日志，发现死锁发生在批量导入时，数据库死锁日志中有大量的死锁信息，如下：</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code><span class="line"><span class="token keyword">create</span> <span class="token keyword">table</span> t_daily_recon<span class="token punctuation">(</span></span>
<span class="line">    trans_id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span></span>
<span class="line">    trans_date <span class="token keyword">date</span><span class="token punctuation">,</span></span>
<span class="line">    trans_amount <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">default</span> <span class="token keyword">charset</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>三个事务同时执行<code>insert into t_daily_recon values(10, &#39;2021-01-01&#39;, 1000.00)</code>，其中trans_id为主键，插入数据时发生死锁。</p><p>查看死锁日志，发现有大量的死锁信息， 发现其事务1持有S锁，请求表的IX锁，由于IX锁和S锁冲突， 事务2也持有S锁，请求表的IX锁，由于IX锁和S锁冲突，导致死锁发生。</p><h2 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案"><span>解决方案</span></a></h2><p>将并发批量导入，修改成串行批量导入.</p>`,10)]))}const o=s(p,[["render",l]]),r=JSON.parse('{"path":"/guide/Java%E5%9C%BA%E6%99%AF%E9%A2%98/1-%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98.html","title":"批量导入死锁问题","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"问题描述","slug":"问题描述","link":"#问题描述","children":[]},{"level":2,"title":"解决方案","slug":"解决方案","link":"#解决方案","children":[]}],"git":{"updatedTime":1746194446000,"contributors":[{"name":"alice","username":"alice","email":"921757697@qq.com","commits":1,"url":"https://github.com/alice"}],"changelog":[{"hash":"4951c196adb449238836dbb0eba9d13fbc2594be","time":1746194446000,"email":"921757697@qq.com","author":"alice","message":"deploy jvm"}]},"filePathRelative":"guide/Java场景题/1-批量导入死锁问题.md"}');export{o as comp,r as data};
