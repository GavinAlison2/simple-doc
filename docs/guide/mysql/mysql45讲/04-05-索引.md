# 04-05 索引

## 04 | 深入浅出索引（上）

索引的常见模型

- 哈希表，不适合做区间搜索。
- 有序数组，只适合静态数据，插入麻烦。
- B树，支持区间搜索，查询效率稳定。
- Memory，支持快速查询，但数据量大时，内存占用大。

InnoDB 的索引模型

- 在 MySQL 中，索引是在存储引擎层实现的。
- 以主键顺序存在B+树中。
- 主键索引（聚簇索引） 的叶子节点存的是整行数据。主键查询主需要扫描主键索引。
- 非主键索引（二级索引）*的叶子节点内容是主键的值。通过二级索引需要扫描二级索引树，找到主键后再扫描主键索引。该过程称为*回表。

索引维护

- 索引的维护是指对索引树进行维护，包括创建索引、删除索引、更新索引、维护索引。
- 当插入到索引树最后，只需直接插入。
- 但当插入到索引树中间，需要逻辑上挪动后面的数据，空出位置，并且当数据页满时，需要申请一个新的数据页，然后挪动部分数据过去（页分裂）。
- 当相邻两个页由于删除了数据，利用率很低之后，会将数据页做合并。
- 自增索引（追加操作，都不涉及到挪动其他记录，也不会触发叶子节点的分裂）
- 业务逻辑的字段做主键，则往往不容易保证有序插入，这样写数据成本相对较高。
- 二级索引的叶子节点为主键，业务字段做主键时会占大量存储空间。
- 什么时候可以使用业务字段做主键？ 只有一个索引；该索引必须是唯一索引。

## 05 | 深入浅出索引（下）

- 覆盖索引
- 最左前缀原则
- 索引下推

```md
覆盖索引
当查询值已经在二级索引上时，不需要回表。

最左前缀原则
联合索引合理安排顺序，可以少维护索引，或者减少存储空间。
idx(a,b,c)


索引下推

MySQL 5.6 引入的索引下推优化，可以在索引遍历过程中，对索引中包含的字段先做判断，直接过滤掉不满足条件的记录，减少回表次数。
```
